NOTE: parts of this script were based on https://github.com/ucscGenomeBrowser/kent/blob/master/src/hg/utils/otto/clinvar/clinVarToBed
      That script indicates that the data sources occasionally have format changes that can break parsing scripts, including this one.
      Future use of this script may require modification due to this.


ncbi_to_vcf.py is used to combine two separate sources of clinvar data into a vcf for usage in workflows. To use inside the provided Docker container, run
python /usr/bin/ncbi_to_vcf.py <tsv_file> <vcf>
Output is to stdout by default


Files used to generate the initial vcf, and where to find updated versions in the future:

tsv_file: found in ftp://ftp.ncbi.nlm.nih.gov/pub/clinvar/tab_delimited/
At the time of writing, this file was located at ftp://ftp.ncbi.nlm.nih.gov/pub/clinvar/tab_delimited/variant_summary.txt.gz
In the future, it will be archived at ftp://ftp.ncbi.nlm.nih.gov/pub/clinvar/tab_delimited/archive/variant_summary_2018-11.txt.gz
Since the file name is not versioned until it is moved to the archive folder, the md5 hash should be downloaded along with the file
ftp://ftp.ncbi.nlm.nih.gov/pub/clinvar/tab_delimited/variant_summary.txt.gz.md5

vcf: found in ftp://ftp.ncbi.nlm.nih.gov/pub/clinvar/vcf_GRCh38/
At the time of writing, this file was located at ftp://ftp.ncbi.nlm.nih.gov/pub/clinvar/vcf_GRCh38/clinvar_20181028.vcf.gz
In the future, it will be archived at ftp://ftp.ncbi.nlm.nih.gov/pub/clinvar/vcf_GRCh38/archive_2.0/2018/clinvar_20181028.vcf.gz
The file name is versioned in the main directory, so the name will be different when using this in the future.


Once variant_summary.txt.gz and clinvar_yyyymmdd.vcf.gz have been downloaded, unpack them using bgzip, included in this docker image.
bgzip -d <file> will delete the original and write to a new file with the .gz suffix dropped
bgzip -cd <file> will keep the original and write the decompressed version to stdout
Note that files are stored in this repository in a compressed format to save space.

The vcf header contains descriptions of the added fields and was thus written by hand and stored in the header.txt file. Copy its
contents into a file, then append the output of ncbi_to_vcf.py to it to produce a valid vcf. The original custom.vcf in this repository
was generated by copying the header into a file called custom.vcf, then running:

python ncbi_to_vcf.py variant_summary.txt clinvar_20181028.vcf >> custom.vcf
